# 🧪 M1-M4 模組測試指南

## 🎯 **測試目標**
測試 LINE Bot 的 M1-M4 模組分析功能，確保能正確觸發對應的 Flex Message 圖卡。

## 📋 **測試準備**

### **系統狀態確認**
- ✅ 增強版 Chatbot API: 運行在 port 8008
- ✅ Webhook Server: 運行在 port 8081  
- ✅ ngrok Tunnel: 活躍且穩定
- ✅ LINE Bot: 已配置增強版 API

### **測試環境**
- **API URL**: `http://localhost:8008/analyze`
- **Webhook URL**: `https://4edba6125304.ngrok-free.app/webhook`

## 🧪 **M1 警訊分析測試**

### **測試訊息 (觸發 M1 圖卡)**
```
爸爸忘記關瓦斯
媽媽不會用洗衣機
爺爺在熟悉地方迷路
奶奶說不出想說的話
外公判斷力變差
```

### **預期結果**
- 🚨 **紅色標題**: "M1 警訊分析"
- 📝 **顯示**: 檢測到的警訊編號 (M1-01 到 M1-05)
- 💡 **建議**: "及早發現，及早介入"

## 🧪 **M2 病程階段測試**

### **測試訊息 (觸發 M2 圖卡)**
```
媽媽輕度失智
爸爸中度失智
爺爺重度失智
奶奶初期症狀
外公晚期症狀
```

### **預期結果**
- 📊 **標題**: "M2 病程階段"
- 🎨 **顏色**: 輕度(黃色)、中度(橙色)、重度(紅色)
- 🎯 **顯示**: 評估的病程階段
- 💡 **建議**: "根據階段調整照護策略"

## 🧪 **M3 BPSD 症狀測試**

### **測試訊息 (觸發 M3 圖卡)**
```
爺爺有妄想症狀
奶奶看到幻覺
媽媽很憂鬱
爸爸容易焦慮
外公很易怒
```

### **預期結果**
- 🧠 **紫色標題**: "M3 BPSD 症狀"
- ⚠️ **顯示**: 檢測到的 BPSD 症狀
- 💡 **建議**: "尋求專業醫療協助"

## 🧪 **M4 照護需求測試**

### **測試訊息 (觸發 M4 圖卡)**
```
需要醫療協助
需要照護服務
需要安全防護
需要環境改造
需要社會資源
```

### **預期結果**
- 🏥 **藍色標題**: "M4 照護需求"
- 🎯 **顯示**: 識別的照護需求類別
- 💡 **建議**: "尋求相關資源協助"

## 🔄 **綜合測試**

### **智能路由測試**
系統會根據內容自動選擇最適合的模組：

1. **有警訊關鍵詞** → M1 圖卡
2. **有 BPSD 症狀** → M3 圖卡  
3. **有照護需求** → M4 圖卡
4. **其他情況** → M2 圖卡

### **測試流程**
1. 在 LINE 中發送測試訊息
2. 觀察回應的圖卡類型
3. 確認圖卡內容正確
4. 測試不同關鍵詞組合

## 📱 **LINE 測試步驟**

### **1. 更新 Webhook URL**
```
https://4edba6125304.ngrok-free.app/webhook
```

### **2. 發送測試訊息**
在 LINE 中依序發送：

**M1 測試**:
```
爸爸忘記關瓦斯
```

**M2 測試**:
```
媽媽中度失智
```

**M3 測試**:
```
爺爺有妄想症狀
```

**M4 測試**:
```
需要醫療協助
```

### **3. 觀察回應**
- ✅ 收到對應的 Flex Message 圖卡
- ✅ 圖卡標題和顏色正確
- ✅ 分析結果準確
- ✅ 建議內容適當

## 🛠️ **故障排除**

### **如果沒有收到回應**
1. 檢查 ngrok 狀態: `curl https://4edba6125304.ngrok-free.app/health`
2. 檢查 API 狀態: `curl http://localhost:8008/health`
3. 檢查 webhook 狀態: `curl http://localhost:8081/health`

### **如果圖卡不正確**
1. 確認關鍵詞是否匹配
2. 檢查 API 回應格式
3. 查看 webhook 日誌

## 📊 **測試結果記錄**

| 模組 | 測試訊息 | 預期圖卡 | 實際結果 | 狀態 |
|------|----------|----------|----------|------|
| M1 | 爸爸忘記關瓦斯 | 🚨 M1 警訊 | | |
| M2 | 媽媽中度失智 | 📊 M2 病程 | | |
| M3 | 爺爺有妄想症狀 | 🧠 M3 BPSD | | |
| M4 | 需要醫療協助 | 🏥 M4 照護 | | |

## 🎉 **成功標準**
- ✅ 所有 4 個模組都能正確觸發
- ✅ 圖卡樣式和內容正確
- ✅ 智能路由功能正常
- ✅ 回應時間在 3 秒內

---
**最後更新**: 2025-08-02 21:50:00 